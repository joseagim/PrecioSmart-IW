<!DOCTYPE html>
<html class="h-100" xmlns:th="http://www.thymeleaf.org">

<head>
    <th:block th:replace="~{fragments/head :: header}" />
    <title>IW: Welcome</title>

</head>

<body class="d-flex flex-column h-100 text-center">
    <header th:replace="~{fragments/nav.html :: nav}"></header>

    <main class="flex-shrink-0">
        <div class="container">
            <h1 class="mt-5 mb-5">B√∫squeda de productos</h1>

            <div class="search-container mb-5">
                <div class="input-group">
                    <span class="input-group-text bg-white border-end-0" style="border-radius: 12px 0 0 12px;">
                        <i class="bi bi-search text-muted"></i>
                    </span>
                    <input type="text" id="producto" class="form-control border-start-0"
                        placeholder="Busca por c√≥digo EAN o nombre del producto..."
                        style="padding: 12px; border-radius: 0;">
                    <button id="buscar" class="btn btn-naranja" type="button" style="border-radius: 0 12px 12px 0;">
                       üîç Buscar
                    </button>
                </div>

                <button class="btn btn-scan mt-3">
                    <i class="bi bi-qr-code-scan me-2"></i>‚õ∂ Escanear c√≥digo de barras 
                </button>
            </div>

            <div id="cuerpo-resultados" class="row row-cols-1 row-cols-md-3 g-4 justify-content-center"></div>
        </div>

        <template id="plantilla_card">
            <div class="col">
                <div class="card h-100 card-naranja shadow-sm">
                    <img src="" class="card-img-top img-producto" alt="Imagen de producto">
                    <div class="card-body d-flex flex-column text-center">
                        <h5 class="card-title text-naranja fw-bold"></h5>
                        <ul class="list-group list-group-flush text-start mb-3">
                            <li class="list-group-item tamano small"></li>
                            <li class="list-group-item precio fw-bold"></li>
                        </ul>
                        <button class="btn btn-naranja mt-auto btn-comparar">Comparar</button>
                    </div>
                </div>
            </div>
        </template>

        <script>
            const inputProducto = document.getElementById('producto');
            const botonBuscar = document.getElementById('buscar');
            const cuerpoResultados = document.getElementById('cuerpo-resultados');
            const plantilla = document.getElementById('plantilla_card').content;

            let productos = [
                // Cambiamos la propiedad 'peso' por 'tamano'
                { name: 'Leche Pascual', tamano: '1L', price: 1.5, img: '/img/products/lechePascual.png' },
                { name: 'Leche Asturiana', tamano: '1L', price: 1.4, img: '/img/products/lecheAsturiana.png' },
                { name: 'Leche Hacendado', tamano: '1L', price: 1.3, img: '/img/products/lecheHacendado.jpg' },
                { name: 'Arroz SOS', tamano: '1kg', price: 1.2 },
                { name: 'Az√∫car', tamano: '1kg', price: 0.9 },
                { name: 'Huevos', tamano: '12 uds', price: 2.0 },
                { name: 'Queso', tamano: '250g', price: 3.5 },
            ];

            botonBuscar.addEventListener('click', () => {
                cuerpoResultados.innerHTML = "";
                const busqueda = inputProducto.value.trim().toLowerCase();
                const filtrados = productos.filter(p => p.name.toLowerCase().includes(busqueda));

                if (filtrados.length === 0 && busqueda !== "") {
                    alert('Producto no encontrado');
                    return;
                }

                filtrados.forEach(producto => {
                    const clon = plantilla.cloneNode(true);

                    clon.querySelector('.card-title').textContent = producto.name;

                    const imagen = clon.querySelector('.img-producto');
                    imagen.src = producto.img;
                    imagen.alt = `Imagen de ${producto.name}`;

                    // Ahora buscamos .tamano y ponemos el texto "Tama√±o"
                    clon.querySelector('.tamano').textContent = "Tama√±o: " + producto.tamano;
                    clon.querySelector('.precio').textContent = `${producto.price.toFixed(2)} ‚Ç¨`;

                    clon.querySelector('.btn-comparar').onclick = () => {
                        alert(`Comparando: ${producto.name}`);
                    };

                    cuerpoResultados.appendChild(clon);
                });
            });
        </script>
    </main>

    <th:block th:replace="~{fragments/footer.html :: footer}" />
</body>

</html>